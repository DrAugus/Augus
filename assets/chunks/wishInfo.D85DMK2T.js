import{d as m,w as h,x,y as M,B as j,r as u,h as v}from"./utils.D0TYFXdU.js";import"./zh.sXGPeAhE.js";m.locale("zh");const p=10;let g=m().year(2e3),l=m();const b=(r,i,s)=>{let o,n;r.start=r.start.replace(/-/g,"/"),r.end=r.end.replace(/-/g,"/"),o=x(r.start).subtract(0,"minute"),n=x(r.end).subtract(0,"minute");const c=n.diff(o,"day",!0);return g<n&&(g=n),{...r,index:i,index2:s,start:o,end:n,duration:c}},W=r=>{let i=[],s={},o=[],n=[],c=[];c[h.Characters]=r.characters,c[h.Weapons]=r.weapons,r.chronicled&&(c[h.Chronicled]=r.chronicled);let d=c.map((t,a)=>Array.isArray(t)?t.map((e,y)=>b(e,a,y)):b(t,a,a));d.slice().sort((t,a)=>Array.isArray(t)&&Array.isArray(a)?t[0].start-a[0].start:!Array.isArray(t)&&Array.isArray(a)?t.start-a[0].start:Array.isArray(t)&&!Array.isArray(a)?t[0].start-a.start:t.start-a.start).forEach((t,a)=>{if(a===0&&(Array.isArray(t)?l=t[0].start.set("hour",0).set("minute",0).set("second",0).subtract(p,"day"):l=t.start.set("hour",0).set("minute",0).set("second",0).subtract(p,"day")),Array.isArray(t))for(let e=0;e<t.length;e++){const y=t[e];d[y.index][e].offset=Math.abs(l.diff(d[y.index][e].start,"day",!0))}else d[t.index].offset=Math.abs(l.diff(t.start,"day",!0))});const f=Math.abs(Math.ceil(l.diff(g,"day",!0)))+2*p;for(let t=0;t<f;t++){const a=l.add(t,"day").format("YYYY"),e=l.add(t,"day").format("MMMM");s[a]===void 0&&(s[a]={}),s[a][e]===void 0&&(s[a][e]={total:0,offset:0}),s[a][e].total++}o=Object.entries(s);for(let t=0;t<o.length;t++){let a=Object.entries(o[t][1]);n=n.concat(a)}for(let t=0;t<n.length;t++)n[t][1].offset=t-1>=0?n[t-1][1].total+n[t-1][1].offset:0;return i=[...new Array(f)].map((t,a)=>{const e=l.add(a,"day");return[e.date(),e.format("dd")]}),{dates:i,years:s,yearList:o,monthList:n,events:d,firstDay:l}},E=r=>{let i={wishIndex:[],comingIndex:[]};for(let s of r){let o=m().isAfter(s.start,"second"),n=m().isBefore(s.end,"second");o&&n&&i.wishIndex.push(s.index2),m().isBefore(s.start,"second")&&i.comingIndex.push(s.index2)}return i},D=(r,i=0)=>{var t,a;let s=v(i),o=[];for(let e=0;e<r.name.length;++e)o.push(`/image/${s}/wish/${M(r.name[e],r.image[e])}`);let n=j(r.start),c=j(r.end),d=r.wish5star;Array.isArray(d)?d=d==null?void 0:d.map((e,y,A)=>u(e)):d.characters=(t=d.characters)==null?void 0:t.map((e,y,A)=>u(e));let f=r.wish4star;return Array.isArray(f)?f=f==null?void 0:f.map((e,y,A)=>u(e)):f.characters=(a=f.characters)==null?void 0:a.map((e,y,A)=>u(e)),{name:r.wishName,date:n+" ~ "+c,ver:r.version,image:r.image,src:o,wish5star:d,wish4star:f}},T=(r,i,s=0)=>{let o={index:i,able:i.length>0,obj:[]};for(let n of i){const c=D(r[n],s);o.obj.push(c)}return o};export{T as a,E as g,W as p};
